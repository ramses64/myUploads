private static uint ChooseEffect(uint grfKeyState, uint allowedEffects)
{
    const uint MK_CONTROL = 0x0008; // Ctrl pressed
    bool ctrl = (grfKeyState & MK_CONTROL) != 0;

    // prefer COPY when Ctrl is pressed, otherwise MOVE
    if (ctrl && (allowedEffects & 1 /*COPY*/) != 0)
        return 1; // DROPEFFECT_COPY

    if ((allowedEffects & 2 /*MOVE*/) != 0)
        return 2; // DROPEFFECT_MOVE

    if ((allowedEffects & 1 /*COPY*/) != 0)
        return 1; // fallback to copy

    return 0; // DROPEFFECT_NONE
}