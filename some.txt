<form id="sendForm" method="post">
  @Html.AntiForgeryToken()
  <input type="email" id="toEmail" placeholder="recipient@example.com" required />
  <button type="button" onclick="sendViaMail()">Send via mail</button>
</form>

<script>
async function sendViaMail() {
  const toEmail = document.getElementById("toEmail").value;

  const form = document.getElementById("sendForm");
  const token = form.querySelector('input[name="__RequestVerificationToken"]').value;

  const body = new URLSearchParams();
  body.append("__RequestVerificationToken", token);
  body.append("toEmail", toEmail);

  const res = await fetch("/Mail/CreateDraftAndGetComposeLink", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body
  });

  if (!res.ok) {
    const errText = await res.text();
    alert("Error:\n" + errText);
    return;
  }

  const data = await res.json();

  // This triggers Outlook/new Outlook (or web) depending on the user's environment
  window.open(data.composeLink, "_blank");
}
</script>
